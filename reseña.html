<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envía tu Reseña - Entrenador Personal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .star-rating {
            direction: rtl;
        }
        .star-rating input {
            display: none;
        }
        .star-rating label {
            color: #d1d5db;
            font-size: 2rem;
            padding: 0 5px;
            cursor: pointer;
            transition: color 0.2s;
        }
        .star-rating input:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #fbbf24;
        }
        .preview-image {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">
    
    <!-- Header -->
    <header class="bg-gray-900/80 backdrop-blur-sm">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-green-400">TU LOGO</a>
            <nav class="hidden md:flex space-x-8">
                <a href="index.html" class="hover:text-green-400 transition-colors">Volver a Inicio</a>
            </nav>
        </div>
    </header>

    <!-- Contenido Principal -->
    <main class="flex-grow flex items-center justify-center py-12">
        <div class="container mx-auto px-6">
            <!-- Pantalla de contraseña -->
            <div id="password-screen" class="max-w-md mx-auto bg-gray-800 rounded-2xl shadow-xl p-8">
                <h1 class="text-3xl font-bold mb-2 text-center text-green-400">Acceso a Reseñas</h1>
                <p class="text-gray-400 mb-6 text-center">Introduce la contraseña para enviar tu reseña.</p>
                <div class="space-y-4">
                    <input type="password" id="password-input" placeholder="Contraseña" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <button id="password-submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300">Acceder</button>
                    <p id="password-error" class="text-red-400 text-center hidden">Contraseña incorrecta. Inténtalo de nuevo.</p>
                </div>
            </div>

            <!-- Formulario de reseña (inicialmente oculto) -->
            <div id="review-form-container" class="max-w-2xl mx-auto bg-gray-800 rounded-2xl shadow-xl p-8 hidden">
                <h1 class="text-3xl font-bold mb-2 text-center text-green-400">Comparte tu Experiencia</h1>
                <p class="text-gray-400 mb-8 text-center">Tu opinión ayuda a otros a dar el primer paso hacia su transformación.</p>
                
                <form id="review-form" class="space-y-6">
                    <!-- Nombre -->
                    <div>
                        <label for="client-name" class="block text-sm font-medium text-gray-300 mb-2">Tu nombre</label>
                        <input type="text" id="client-name" placeholder="Ej: María González" maxlength="150" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    </div>
                    
                    <!-- Foto -->
                    <div>
                        <label for="client-photo" class="block text-sm font-medium text-gray-300 mb-2">Tu foto (opcional)</label>
                        <div class="flex items-center space-x-4">
                            <input type="file" id="client-photo" accept="image/*" class="hidden">
                            <button type="button" id="upload-photo-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">Seleccionar foto</button>
                            <span id="photo-name" class="text-gray-400 text-sm">Ninguna foto seleccionada</span>
                        </div>
                        <div id="photo-preview" class="mt-3 hidden">
                            <img id="preview-img" class="preview-image" src="" alt="Vista previa">
                        </div>
                    </div>
                    
                    <!-- Comentario -->
                    <div>
                        <label for="client-review" class="block text-sm font-medium text-gray-300 mb-2">Tu reseña</label>
                        <textarea id="client-review" rows="5" placeholder="Comparte tu experiencia, resultados, cómo te ha ayudado el entrenamiento..." maxlength="150" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500" required></textarea>
                    </div>
                    
                    <!-- Valoración con estrellas -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Valoración</label>
                        <div class="star-rating flex justify-center">
                            <input type="radio" id="star5" name="rating" value="5">
                            <label for="star5">★</label>
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4">★</label>
                            <input type="radio" id="star3" name="rating" value="3">
                            <label for="star3">★</label>
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2">★</label>
                            <input type="radio" id="star1" name="rating" value="1" required>
                            <label for="star1">★</label>
                        </div>
                    </div>
                    
                    <!-- Botón de envío -->
                    <div class="pt-4">
                        <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300">Enviar Reseña</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 py-8 mt-12">
        <div class="container mx-auto px-6 text-center">
            <div class="text-gray-500 text-sm">
                &copy; <span id="year"></span> Tu Nombre | Entrenador Personal. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <!-- Modal de confirmación -->
    <div id="success-modal" class="fixed inset-0 z-50 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-2xl shadow-xl w-full max-w-md text-white relative p-8 text-center">
            <div class="mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold mb-4 text-green-400">¡Reseña Enviada!</h2>
            <p class="text-gray-300 mb-6">Gracias por compartir tu experiencia. Tu reseña aparecerá en la página principal una vez sea aprobada.</p>
            <div class="flex space-x-4">
                <button id="back-to-home" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Volver al inicio</button>
                <button id="new-review" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Nueva reseña</button>
            </div>
        </div>
    </div>

    <script>
        // Establecer año actual en el footer
        document.getElementById('year').textContent = new Date().getFullYear();
        
        // --- Lógica de contraseña ---
        const passwordScreen = document.getElementById('password-screen');
        const reviewFormContainer = document.getElementById('review-form-container');
        const passwordInput = document.getElementById('password-input');
        const passwordSubmit = document.getElementById('password-submit');
        const passwordError = document.getElementById('password-error');
        const correctPassword = 'cliente123'; // Contraseña definida

        passwordSubmit.addEventListener('click', () => {
            if (passwordInput.value === correctPassword) {
                // Contraseña correcta, mostrar formulario
                passwordScreen.classList.add('hidden');
                reviewFormContainer.classList.remove('hidden');
            } else {
                // Contraseña incorrecta, mostrar error
                passwordError.classList.remove('hidden');
            }
        });

        // También permitir enviar con Enter
        passwordInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                passwordSubmit.click();
            }
        });

        // --- Manejo de la subida de foto ---
        const uploadPhotoBtn = document.getElementById('upload-photo-btn');
        const clientPhotoInput = document.getElementById('client-photo');
        const photoName = document.getElementById('photo-name');
        const photoPreview = document.getElementById('photo-preview');
        const previewImg = document.getElementById('preview-img');
        
        uploadPhotoBtn.addEventListener('click', () => {
            clientPhotoInput.click();
        });
        
        clientPhotoInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                photoName.textContent = file.name;
                
                // Mostrar vista previa
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    photoPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                photoName.textContent = 'Ninguna foto seleccionada';
                photoPreview.classList.add('hidden');
            }
        });

        // --- Manejo del envío del formulario (VERSIÓN CORREGIDA) ---
        const reviewForm = document.getElementById('review-form');
        const successModal = document.getElementById('success-modal');
        const backToHomeBtn = document.getElementById('back-to-home');
        const newReviewBtn = document.getElementById('new-review');
        
        reviewForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validar que se haya seleccionado una valoración
            const ratingElement = document.querySelector('input[name="rating"]:checked');
            if (!ratingElement) {
                alert('Por favor, selecciona una valoración con estrellas');
                return;
            }
            
            // Obtener datos del formulario
            const name = document.getElementById('client-name').value;
            const review = document.getElementById('client-review').value;
            const rating = ratingElement.value;
            
            // Obtener la foto si se subió
            let photoData = null;
            if (clientPhotoInput.files.length > 0) {
                const file = clientPhotoInput.files[0];
                try {
                    photoData = await readFileAsDataURL(file);
                } catch (error) {
                    console.error('Error al leer la imagen:', error);
                }
            }
            
            saveReview(name, review, rating, photoData);
        });

        // Función para leer archivos como Data URL (promise-based)
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsDataURL(file);
            });
        }

        function saveReview(name, review, rating, photoData) {
            try {
                // Obtener reseñas existentes del localStorage
                let reviews = JSON.parse(localStorage.getItem('clientReviews') || '[]');
                
                // Crear nueva reseña
                const newReview = {
                    id: Date.now(), // ID único basado en timestamp
                    name: name,
                    review: review,
                    rating: parseInt(rating),
                    photo: photoData,
                    date: new Date().toISOString(),
                    approved: false // Por defecto no está aprobada
                };
                
                // Añadir nueva reseña
                reviews.push(newReview);
                
                // Guardar en localStorage
                localStorage.setItem('clientReviews', JSON.stringify(reviews));
                
                console.log('Reseña guardada:', newReview);
                console.log('Total de reseñas:', reviews.length);
                
                // Mostrar modal de éxito
                successModal.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error al guardar la reseña:', error);
                alert('Error al guardar la reseña. Por favor, intenta de nuevo.');
            }
        }
        
        // Botones del modal de éxito
        backToHomeBtn.addEventListener('click', () => {
            window.location.href = 'index.html';
        });
        
        newReviewBtn.addEventListener('click', () => {
            successModal.classList.add('hidden');
            reviewForm.reset();
            photoPreview.classList.add('hidden');
            photoName.textContent = 'Ninguna foto seleccionada';
            
            // Resetear estrellas
            document.querySelectorAll('input[name="rating"]').forEach(radio => {
                radio.checked = false;
            });
        });

        // Debug: Verificar que las reseñas se están guardando
        console.log('Reseñas actuales en localStorage:', JSON.parse(localStorage.getItem('clientReviews') || '[]'));
    </script>
</body>
</html>